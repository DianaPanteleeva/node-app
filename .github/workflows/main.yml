name: ðŸš€ Docker CI/CD

on:
  push:
    branches: [ main ]

jobs:
  docker:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v3
      
      - name: ðŸ”§ Setup and Build
        run: |
          # 1. ÐŸÐ¾ÐºÐ°Ð¶ÐµÐ¼ ÐºÐ°ÐºÐ¸Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ ÐµÑÑ‚ÑŒ
          echo "ðŸ“ Files in repository:"
          ls -la
          
          # 2. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ð¼ package.json
          echo "ðŸ“¦ package.json content:"
          cat package.json || echo "package.json not found!"
          
          # 3. Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Dockerfile
          cat > Dockerfile << 'EOF'
          FROM node:18-alpine
          WORKDIR /app
          COPY package.json package-lock.json ./
          RUN npm install
          COPY . .
          EXPOSE 4000
          CMD ["npm", "start"]
          EOF
          
          echo "âœ… Dockerfile created:"
          cat Dockerfile
          
          # 4. Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¾Ð±Ñ€Ð°Ð·
          docker build -t test-image .
          
      - name: ðŸ” Login to DockerHub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
      
      - name: ðŸ³ Push to DockerHub
        run: |
          docker tag test-image ${{ secrets.DOCKERHUB_USERNAME }}/node-app:latest
          docker push ${{ secrets.DOCKERHUB_USERNAME }}/node-app:latest
